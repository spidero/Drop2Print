{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>{{ t.settings }}</h2>
  <form id="settings-form" class="grid">
    <label>{{ t.copies_label }}
      <input type="number" name="copies" id="copies-input" min="1" value="{{ copies }}">
    </label>
    <button type="submit">{{ t.save }}</button>
  </form>
  <div id="settings-status" class="status"></div>
</section>

<section class="card">
  <h2>{{ t.stats }}</h2>
  <div class="stats">
    <div class="stat">
      <div class="stat-value">{{ stats.total_jobs }}</div>
      <div class="stat-label">{{ t.total_jobs }}</div>
    </div>
    <div class="stat">
      <div class="stat-value">{{ stats.printed }}</div>
      <div class="stat-label">{{ t.printed }}</div>
    </div>
  </div>
</section>

<section class="card">
  <h2>{{ t.recent_jobs }}</h2>
  <table class="jobs-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>File</th>
        <th>Status</th>
        <th>Copies</th>
        <th>Created</th>
      </tr>
    </thead>
    <tbody>
    {% for job in recent_jobs %}
      <tr>
        <td>{{ job.id }}</td>
        <td>{{ job.filename }}</td>
        <td>{{ job.status }}</td>
        <td>{{ job.copies }}</td>
        <td>{{ job.created_at }}</td>
      </tr>
    {% else %}
      <tr><td colspan="5">{{ t.jobs_empty }}</td></tr>
    {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
{% block scripts %}
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("settings-form");
    const statusEl = document.getElementById("settings-status");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = window.I18N.save || "Save";
      const formData = new FormData(form);
      try {
        const res = await fetch("/api/settings", { method: "POST", body: formData });
        if (!res.ok) throw new Error(window.I18N.save_error || "Save error");
        statusEl.textContent = window.I18N.save_success || "Saved.";
      } catch (err) {
        statusEl.textContent = err.message;
      }
    });
  });
</script>
{% endblock %}
